<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Cake Template" />
    <meta name="keywords" content="Cake, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Cake | Template</title>

    <!--Google Font-->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!--Css Styles-->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/flaticon.css" type="text/css" />
    <link rel="stylesheet" href="css/barfiller.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <link rel="stylesheet" href="css/shoping-cart.css" type="text/css" />
    <link rel="stylesheet" href="css/style_search.css" type="text/css" />
  </head>

  <body>
    <!-- Shopping Cart Section Begin -->
    <section class="shopping-cart spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <div class="shopping__cart__table">
              <table>
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="cart-items">
                  <!-- Cart items will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="continue__btn">
                  <a href="#">Continue Shopping</a>
                </div>
              </div>
              <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="continue__btn update__btn">
                  <a href="./shoping-cart.html"> Update cart</a>

                  <!--./shoping-cart.html-->
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="cart__discount">
              <h6>Discount codes</h6>
              <form action="#">
                <input type="text" placeholder="Coupon code" />
                <button type="submit">Apply</button>
              </form>
            </div>
            <div class="cart__total">
              <h6>Cart total</h6>
              <ul>
                <li>
                  Subtotal:
                  <div
                    id="cart__price"
                    class="cart__price"
                    style="display: flex"
                  >
                    <span>$0.00</span>
                  </div>
                </li>

                <li>
                  Total:
                  <div
                    id="cart__price"
                    class="cart__price"
                    style="display: flex"
                  >
                    <span> $0.00</span>
                  </div>
                </li>
              </ul>
              <a href="#" class="primary-btn">Proceed to checkout</a>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Shopping Cart Section End -->

    <!--Js Plugins-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.barfiller.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/script_search.js"></script>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetchCart();
      });

      function fetchCart() {
        fetch("CartServlet")
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              window.location.href = "login.jsp";
              return;
            }
            renderCart(data.cart);
            updateCartTotals(data);
          })
          .catch((error) => {
            console.error("Error fetching cart:", error);
            alert("Error loading cart. Please try again.");
          });
      }

      function renderCart(cart) {
        const cartItemsContainer = document.getElementById("cart-items");
        cartItemsContainer.innerHTML = "";

        if (cart.length === 0) {
          cartItemsContainer.innerHTML = `
                                                <tr>
                                                    <td colspan="4" class="text-center">Your cart is empty</td>
                                                </tr>
                                            `;
          return;
        }

        cart.forEach((item) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                <td class="product__cart__item">
                    <div class="product__cart__item__pic">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="product__cart__item__text">
                        <h6>${item.name}</h6>
                        <h5>$${item.price.toFixed(2)}</h5>
                    </div>
                </td>
            
            
            
            
            
            
                <td class="quantity__item">
                    <div class="quantity">
                        <button class="quantity-btn decrease" onclick="updateQuantity(${
                          item.id
                        }, ${item.quantity - 1})">-</button>
                        <input type="text" value="${item.quantity}" readonly>
                        <button class="quantity-btn increase" onclick="updateQuantity(${
                          item.id
                        }, ${item.quantity + 1})">+</button>
                    </div>
                </td>
                <td class="cart__price">$${(item.price * item.quantity).toFixed(
                  2
                )}</td>
                <td class="cart__close">
                    <span class="delete-item" onclick="removeFromCart(${
                      item.id
                    })">Ã—</span>
                </td>
            `;
          cartItemsContainer.appendChild(row);
        });
      }

      function updateCartTotals(data) {
        // Update cart count in header
        const cartCountElements = document.querySelectorAll(".cart-count");
        cartCountElements.forEach((element) => {
          element.textContent = data.count;
        });

        // Update cart total
        const cartTotalElements =
          document.querySelectorAll(".cart__price span");
        cartTotalElements.forEach((element) => {
          element.textContent = "$" + data.total;
        });
      }

      function updateQuantity(productId, newQuantity) {
        if (newQuantity < 1) return;

        fetch("CartServlet", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: `action=update&id=${productId}&quantity=${newQuantity}`,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              alert(data.error);
            } else {
              renderCart(data.cart);
              updateCartTotals(data);
            }
          })
          .catch((error) => {
            console.error("Error updating quantity:", error);
            alert("Error updating quantity. Please try again.");
          });
      }

      function removeFromCart(productId) {
        if (
          !confirm("Are you sure you want to remove this item from your cart?")
        ) {
          return;
        }

        fetch("CartServlet", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: `action=remove&id=${productId}`,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              alert(data.error);
            } else {
              renderCart(data.cart);
              updateCartTotals(data);
            }
          })
          .catch((error) => {
            console.error("Error removing item:", error);
            alert("Error removing item. Please try again.");
          });
      }
    </script>
  </body>
</html>
